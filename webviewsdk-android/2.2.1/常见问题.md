# 常见问题

## 同时接入TVS SDK和WebView SDK时编译失败

同时接入TVS SDK和WebView SDK时，可能会编译失败，出现如下的错误：

![](https://3gimg.qq.com/trom_s/dingdang/upload/20190926/50e1c4bfa9ecbfaa3bcfae00168cd335.png)

这是因为TVS SDK与WebView SDK依赖了同一个库导致类文件冲突，可以修改WebView SDK的依赖方式解决：

```groovy
dependencies {
    // ...
    // 原来的依赖方式
    implementation 'com.tencent.yunxiaowei.webviewsdk:webviewsdk:2.2.0'
    // 新的依赖方式
    implementation('com.tencent.yunxiaowei.webviewsdk:webviewsdk:2.2.0') {
        exclude group: 'com.tencent.yunxiaowei.base', module: 'qrom-component-log'
    }
}
```

修改后重新执行Gradle Sync即可。

## 旧版本SDK的aar文件在哪里？

新版（2.2.0）的WebViewSDK开始发布到Maven Central，不再提供aar文件，请参考接入文档接入。

## 从aar集成升级到Maven Central版本后无法通过编译

新版对部分类进行了整合：

 * `TVSWebDevice`：改为`TVSDevice`
 * `TVSDeviceController`：改用`TVSWebController`
 * `WebController.SimpleBusinessEventListener`：改为`WebController.BusinessEventListener`
 * 找不到方法`TVSWebController#setSimpleBusinessEventListener(WebController.SimpleBusinessEventListener)`：改用`TVSWebController#setBusinessEventListener(WebController.BusinessEventListener)`
 * 找不到方法`TVSWebController#loadURL(String, boolean)`：改用`TVSWebController#loadURL(String)`，只要设置了TVSToken就会被带入对应的云小微网页中

同时，请参考接入文档完成接入流程，包括初始化环境管理器等。

## 如何实现WebView网络不通下展示异常UI？

TVSWebView模块不具备网络连通状态监听功能，但可以轻松实现网络异常提醒。

使用Android提供的API监听网络状态：

```java
@Override
protected void onResume() {
    super.onResume();
    IntentFilter filter = new IntentFilter(ConnectivityManager.CONNECTIVITY_ACTION);
    registerReceiver(new BroadcastReceiver() {
        @Override
        public void onReceive(Context context, Intent intent) {
            ConnectivityManager manager = (ConnectivityManager) context.getSystemService(Context.CONNECTIVITY_SERVICE);
            NetworkInfo info = manager.getActiveNetworkInfo();
            boolean connected = info != null && info.isConnectedOrConnecting();
        }
    }, filter);
}
```

详细的实现方式和API可以参考Android[官方文档](https://developer.android.com/training/monitoring-device-state/connectivity-monitoring)。

通过上面代码片段的`connected`可以判断是否连通了网络，在断开的时候可以直接在TVSWebView上方覆盖一层网络不可达的View，而网络重新恢复的时候隐藏该View并调用`com.tencent.ai.tvs.web.TVSWebController#reload()`刷新网页。

除此以外，在`com.tencent.ai.tvs.web.TVSWebController.UIEventListener#onLoadError()`回调中可以监听网页加载失败的事件，可以在此时展示相应的UI。但需要注意TVSWebView默认启用了离线缓存，在网络故障时会默认加载离线缓存，这会导致该回调未被调用，可以通过调用`com.tencent.ai.tvs.web.WebController#setLoadCacheOnDisconnected(boolean)`关闭离线缓存。