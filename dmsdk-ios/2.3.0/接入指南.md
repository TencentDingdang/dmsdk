# 接入指南

您可以在[TencentDingdang/dmsdk: 腾讯叮当 TVS 手机端 SDK.](https://github.com/TencentDingdang/dmsdk)获取demo工程代码。

DM SDK需要Xcode 10或以上版本才能顺利接入和构建。

## 一、注册 AppId

请参考[云小微账号接入文档](https://dingdang.qq.com/doc/page/365)注册 AppId。

## 二、Xcode 项目配置

### 1 导入依赖库

![linkbinary.png](https://3gimg.qq.com/trom_s/dingdang/upload/20191223/78654e05eaf9b09fe627b7d77c0cc57e.png)

### 2 Search Path 设置

![](https://3gimg.qq.com/trom_s/dingdang/upload/20190705/007603666b834986bed16a0ea9b2222e.png)

### 3 Info.plist 设置

![infoplistlaunch.png](https://3gimg.qq.com/trom_s/dingdang/upload/20191223/34f01c73f840c6b822f2b6ac09a90330.png)

![infoplistwxqq.png](https://3gimg.qq.com/trom_s/dingdang/upload/20191223/1d92972d8347dc2bcc64bec67702388b.png)

### 4 微信 SDK 编译链接问题解决

![](https://3gimg.qq.com/trom_s/dingdang/upload/20190705/1d3feecaf1577b579cc2307686aed49e.png)

### 5 添加CocoaPods依赖

本项目依赖[CocoaLumberjack](https://github.com/CocoaLumberjack/CocoaLumberjack)库用于调试日志输出（包括 console 和文件）、依赖[SSZipArchive](https://github.com/ZipArchive/ZipArchive)用于异常日志打包上报，所以需要在 CocoaPods 中集成，具体配置可参考该项目文档和DM SDK demo。

## 三、打开云小微H5页面

使用TVSWeb模块的TVSWebView可以加载云小微提供的H5页面。

在打开之前，需要先注入当前设备的信息：

```objective-c
_webview.device = [TVSDeviceInfo new];
_webview.device.productId = @"设备的ProductID";
_webview.device.dsn = @"设备的DSN";
```

然后使用`loadUrl`加载云小微提供的页面，例如要打开远程播控页面：

```objective-c
[_webview loadUrl:@"https://ddsdk.html5.qq.com/v2m/musicControl"];
```

注意如果在非正式环境时，需要更改域名为对应的域名。

### ProxyData协议

DM SDK的Web模块提供了ProxyData协议，云小微的H5页面可以通过该协议发送消息和数据给Native端，您只需要实现相应的接口，就能收到这些数据：

```objective-c
#pragma mark TVSWebBusinessDelegate 网页业务回调

// 网页透传数据
-(void)TVSWebProxyData:(NSDictionary *)data {
    NSLog(@"BrowserVC proxyData:%@", data);
}
```

注意将您实现的接口设置到TVSWebView实例中：

```objective-c
_webview.webBusinessDelegate = yourBusinessDelegate;
```

您会收到形如下面所示含有action和data字段的JSON结构数据：

```json
{
  "action": "some-action",
  "data": {
    "key": "some-value-in-data-payload"
  }
}
```

## 四、API列表

**TVSCore.framework**:

&emsp;&emsp;环境配置 [<TVSCore/TVSEnvironment.h>](API文档/账号管理.md)
&emsp;&emsp;账号授权 [<TVSCore/TVSAuth.h>](API文档/账号管理.md)
&emsp;&emsp;设备绑定 [<TVSCore/TVSDevice.h>](API文档/账号管理.md)
&emsp;&emsp;技能服务访问代理 [<TVSCore/TVSTSKMProxy.h>](API文档/技能服务.md)
&emsp;&emsp;闹钟提醒管理 [<TVSCore/TVSAlarmReminder.h>](API文档/技能服务.md)
&emsp;&emsp;儿童模式 [<TVSCore/TVSChildMode.h>](API文档/技能服务.md)
&emsp;&emsp;第三方账号授权 [<TVSCore/TVSThirdPartyAuth.h>](API文档/技能服务.md)
&emsp;&emsp;多端互动 [<TVSCore/TVSDeviceControl.h>](API文档/技能服务.md)

**TVSWeb.framework**:

&emsp;&emsp;Web 页面 [<TVSWeb/TVSWeb.h>](API文档/web页面.md)

**TVSMember.framework**:

&emsp;&emsp;会员状态 [<TVSMember/TVSMember.h>](API文档/会员管理.md)

**TVSSpeech.framework**:

&emsp;&emsp;音色TTS [<TVSSpeech/TVSSpeech.h>](API文档/语音设置.md)


