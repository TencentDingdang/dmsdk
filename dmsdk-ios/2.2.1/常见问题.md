# 常见问题

## 通用

### 如何实现H5 加载失败提示？

以下提供一种参考实现。

使用 [AFNetworking](https://github.com/AFNetworking/AFNetworking) 项目的 `AFNetworkReachabilityManager` 做网络状态监听和判断：

```objective-c
- (void)monitorNetwork {
    AFNetworkReachabilityManager *mgr = [AFNetworkReachabilityManager sharedManager];
    [mgr setReachabilityStatusChangeBlock:^(AFNetworkReachabilityStatus status) {
        BOOL connected = status == AFNetworkReachabilityStatusReachableViaWiFi || status == AFNetworkReachabilityStatusReachableViaWWAN;
        netStatus = connected ? 1 : -1;
        [[NSNotificationCenter defaultCenter] postNotificationName:NotifyNetworkChanged object:self userInfo:@{@"netStatus":[NSNumber numberWithInteger:netStatus]}];
        NSLog(@"NetworkChanged status:%ld netStatus:%d connected:%@", status, netStatus, connected?@"YES":@"NO");
    }];
    [mgr startMonitoring];
}

- (BOOL)networkConnected {
    return netStatus == 1;
}
```

处理网络状态变更：

&emsp;&emsp;1.&emsp;如果处于断开，UI 提示断网；（`AlertViewController` 或者加载自定义 View）；

&emsp;&emsp;2.&emsp;如果已经重新连接，调用 `TVSWebView` 的 `reload` 方法刷新或者直接调用 `loadUrl` 方法重新加载。

```objective-c
-(void)onNetworkChanged:(NSNotification*)notify {
    if ([AppConfig shared].networkConnected) {
        [_webview reload];
    } else {
        [self alertDisconnected];
    }
}
```

`TVSWebView` 遵守 `TVSWebUniversalDelegate` 协议，网页加载失败会回调 `-(void)TVSWebLoadError:(NSError*)error;` 方法，可以用来处理加载失败逻辑：

```objective-c
-(void)TVSWebLoadError:(NSError *)error {
    NSLog(@"TVSWeb load error:%@", error.localizedDescription);
    if (![[AppConfig shared] networkConnected]) {
        [self alertDisconnected];
    } else {
        [self alertLoadFailed];
    }
}
```

## QQ音乐授权

### 授权页面提示“服务器开小差”或“授权失败”要如何定位原因？

首先开启TVSWebView中页面的调试模式：

```objective-c
_webview.showDebugTool = YES;
```

之后再加载页面，会在页面右下方显示小齿轮，表示调试模式开启。调试模式下，“服务器开小差”的提示会更加详细。

而通过TVSWebView的ProxyData接口，可以收到授权失败的错误码和错误信息，请查阅DM SDK的[QQ音乐授权接入指南的《获取授权结果通知》小节](/doc/page/353)。错误码参考`TVSCPError`枚举类型的定义。

### 为什么在iOS 13上会授权失败？

由于iOS 13改变隐私策略，旧版本的QQ音乐应用会无法获取第三方应用的Bundle ID，导致授权失败，请升级QQ音乐客户端到9.5.5及以上后再试。

### 为什么iOS点击“去授权”后会崩溃？

崩溃的栈信息中包含“RSA”字样，则是传错私钥格式导致的，请参考QQ音乐提供的SDK接入文档，传入正确格式的私钥。

### 为什么在QQ音乐中没有弹出授权界面、授权后没有跳回我的应用？

请先确认：

* 已经按照接入文档正确完成接入
* 手机的QQ音乐应用已经更新到最新版本

查阅日志，如果在ProxyData中能够看到错误码、或能够看到QQ音乐SDK的`onAuthFailed`调用的日志，请根据错误码针对性修改；如果不能，则可能是QQ音乐SDK的问题，请在复现后进入QQ音乐应用 - “我的”页面 - 右上角汉堡菜单进入设置 - “帮助与反馈” - 右上角“发日志”，等待日志上传后，将问题描述、上传成功的截图提交给我们跟进。